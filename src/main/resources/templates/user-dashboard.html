<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="UTF-8">
<title>FuelIndeed - User Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- FontAwesome -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
	rel="stylesheet">

<!-- Google Font -->
<link
	href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
	rel="stylesheet">

<style>
:root {
	--fuel-blue: #1565C0;
	--fuel-orange: #FF6F00;
	--bg-light: #f8fafc;
	--bg-dark: #0f172a;
	--card-light: #ffffff;
	--card-dark: #1e293b;
	--text-light: #0f172a;
	--text-dark: #f1f5f9;
}

.text-primary {
	color: var(--fuel-blue) !important;
}

body.dark-mode .text-muted {
	color: #cbd5e1 !important;
}

body.dark-mode .fa-map-marker-alt {
	color: var(--fuel-orange) !important;
}

.btn-primary {
	background: linear-gradient(135deg, #1565C0, #0d47a1);
	border: none;
	border-radius: 50px;
	font-weight: 600;
}

.btn-primary:hover {
	background: linear-gradient(135deg, #0d47a1, #0b3c91);
	transform: translateY(-2px);
}

.nearby-btn {
	background: var(--fuel-orange);
	border: none;
}

.nearby-btn:hover {
	background: #e65100;
}

body {
	font-family: 'Inter', sans-serif;
	transition: 0.3s ease;
	background: var(--bg-light);
}

/* ================= THEME ================= */
body.dark-mode {
	background: var(--bg-dark);
	color: var(--text-dark);
}

body.dark-mode .station-card {
	background: var(--card-dark);
	color: var(--text-dark);
}

body.dark-mode .topbar {
	background: rgba(15, 23, 42, 0.9);
}

body.dark-mode .text-muted {
	color: #cbd5e1 !important;
}

body.dark-mode .fuel-location {
	color: var(--fuel-orange);
}
/* ================= SIDEBAR ================= */
#sidebar {
	width: 230px;
	min-width: 230px;
	max-width: 230px;
	flex-shrink: 0;
	min-height: 100vh;
	background: linear-gradient(180deg, #0f172a, #1e293b);
	transition: 0.3s;
}

#sidebar.collapsed {
	width: 75px;
	min-width: 75px;
	max-width: 75px;
}

#sidebar .nav-text {
	transition: 0.3s;
}

#sidebar.collapsed .nav-text {
	display: none;
}

#sidebar.collapsed .brand {
	display: none;
}

#sidebar.collapsed .nav-link {
	text-align: center;
	justify-content: center;
}

#sidebar .nav-link {
	color: #ffffff !important;
	padding: 14px 18px;
	border-radius: 12px;
	margin-bottom: 6px;
	transition: 0.3s;
}

#sidebar .brand {
	color: #ffffff !important;
}

#sidebar i {
	color: #ffffff;
}

#sidebar .nav-link.active {
	background: rgba(255, 255, 255, 0.15);
	font-weight: 600;
}

/* ================= TOPBAR ================= */
.topbar {
	height: 70px;
	background: rgba(255, 255, 255, 0.8);
	backdrop-filter: blur(10px);
	border-bottom: 1px solid #e2e8f0;
}

/* ================= NAV SEARCH ================= */
.search-bar {
	position: relative;
	width: 350px;
}

.search-bar input {
	border-radius: 50px;
	padding-left: 45px;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.search-bar i {
	position: absolute;
	left: 18px;
	top: 50%;
	transform: translateY(-50%);
	color: #94a3b8;
}

.nearby-btn {
	border-radius: 50px;
}

/* ================= CARDS ================= */
.station-card {
	border-radius: 20px;
	background: var(--card-light);
	transition: 0.35s ease;
	overflow: hidden;
}

.station-card:hover {
	transform: translateY(-8px);
	box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
}

.station-img {
	height: 220px;
	object-fit: cover;
}

.btn-book {
	border-radius: 50px;
	font-weight: 600;
}

.booking-wrapper {
	padding: 20px;
}

.booking-card {
	background: white;
	border-radius: 20px;
	box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
	overflow: hidden;
}

.booking-header {
	background: linear-gradient(135deg, #2563eb, #1d4ed8);
	padding: 20px;
	font-size: 20px;
	font-weight: 600;
	color: white;
}

.booking-body {
	padding: 20px;
}

/* ================= PROFILE ================= */
.profile-icon {
	cursor: pointer;
}

.theme-toggle {
	cursor: pointer;
}

.icon-btn {
	width: 42px;
	height: 42px;
	border-radius: 50%;
	border: none;
	background: #f1f5f9;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: 0.3s;
}

.icon-btn:hover {
	background: #e2e8f0;
}

.custom-dropdown {
	border-radius: 14px;
	box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
}

/* ================= MAIN CONTENT FIX ================= */
.main-content-wrapper {
	padding: 30px 40px;
	min-height: calc(100vh - 70px);
	background: var(--bg-light);
}

/* Dark mode background fix */
body.dark-mode .main-content-wrapper {
	background: #0f172a;
}

/* Make cards same width feel */
.station-card, .booking-card {
	border-radius: 18px;
}

/* Fix booking table spacing */
.booking-card {
	padding: 0;
}

/* Make booking width consistent */
.booking-wrapper {
	max-width: 1100px;
	margin: auto;
}

.top-icons {
	display: flex;
	align-items: center;
	gap: 12px;
}

.icon-btn {
	width: 42px;
	height: 42px;
	border-radius: 50%;
	border: none;
	background: white;
	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
	display: flex;
	align-items: center;
	justify-content: center;
	transition: 0.25s ease;
}

.icon-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
}

body.dark-mode .icon-btn {
	background: #1e293b;
	color: white;
}

.booking-header {
	border-radius: 18px 18px 0 0;
}

.fuel-header {
	background: linear-gradient(90deg, #e3f2fd, #fff3e0);
	border-bottom: 1px solid #e0e0e0;
	padding: 8px 0;
	margin-bottom: 20px; /* ðŸ‘ˆ ye gap dega below content se */
}

.fuel-header i {
	color: #ff9800; /* soft fuel orange */
	font-size: 18px;
}

.fuel-title {
	font-size: 16px;
	letter-spacing: 0.5px;
	color: black; /* petrol green shade */
	color: var(--fuel-blue);
}

.fuel-location {
	color: var(--fuel-orange);
}
</style>
</head>

<body>

	<div class="d-flex" style="min-height: 100vh;">

		<!-- ================= SIDEBAR ================= -->

		<div id="sidebar" class="p-3">

			<div class="brand text-center text-white mb-4">
				<span class="nav-text fw-bold">FuelIndeed</span>
			</div>

			<ul class="nav flex-column">

				<!-- TOGGLE MENU -->
				<li><a href="#" class="nav-link" onclick="toggleSidebar()">
						<i class="fas fa-bars me-2"></i> <span class="nav-text">Menu</span>
				</a></li>

				<!-- DASHBOARD -->
				<li><a href="#" class="nav-link active"
					onclick="setActive(this); location.reload();"> <i
						class="fas fa-home me-2"></i> <span class="nav-text">Dashboard</span>
				</a></li>

				<!-- <li>
            <a th:href="@{/user/search}" class="nav-link"
               onclick="setActive(this)">
                <i class="fas fa-search me-2"></i>
                <span class="nav-text">Search Station</span>
            </a>
        </li> -->

				<li><a href="#" class="nav-link"
					onclick="setActive(this); loadBookings('PENDING')"> <i
						class="fas fa-clock me-2"></i> <span class="nav-text">Pending</span>
				</a></li>

				<li><a href="#" class="nav-link"
					onclick="setActive(this); loadBookings('ASSIGNED')"> <i
						class="fas fa-truck me-2"></i> <span class="nav-text">Assigned</span>
				</a></li>

				<li><a href="#" class="nav-link"
					onclick="setActive(this); loadBookings('DELIVERED')"> <i
						class="fas fa-check-circle me-2"></i> <span class="nav-text">Delivered</span>
				</a></li>

				<li><a href="#" class="nav-link"
					onclick="setActive(this); loadBookings('REJECTED')"> <i
						class="fas fa-times-circle me-2"></i> <span class="nav-text">Rejected</span>
				</a></li>

			</ul>
		</div>

		<!-- ================= MAIN ================= -->

		<div class="flex-grow-1">

			<!-- ================= TOPBAR ================= -->

			<div class="topbar px-4">
				<div class="d-flex align-items-center justify-content-between h-100">
					<div class="d-flex align-items-center gap-2">
						<i class="fas fa-user text-primary"></i> <span class="fw-semibold">User
							Dashboard</span>
					</div>

					<!-- SEARCH BAR -->
					<form class="d-flex align-items-center gap-2"
						th:action="@{/user/search}" method="post">

						<div class="search-bar">
							<i class="fas fa-search"></i> <input type="text" name="area"
								class="form-control" placeholder="Search Nearby Fuel Station...">
						</div>

						<button type="submit" class="btn btn-primary nearby-btn">
							<i class="fas fa-location-arrow"></i>
						</button>
					</form>

					<!-- RIGHT SIDE -->
					<div class="d-flex align-items-center gap-3">

						<div class="top-icons">

							<button class="icon-btn" onclick="toggleTheme()">
								<i id="themeIcon" class="fas fa-moon"></i>
							</button>

							<div class="dropdown">
								<button class="icon-btn dropdown-toggle"
									data-bs-toggle="dropdown">
									<i class="fas fa-user"></i>
								</button>

								<ul class="dropdown-menu dropdown-menu-end custom-dropdown">
									<li><a class="dropdown-item" th:href="@{/user/profile}">
											<i class="fas fa-user me-2"></i>My Profile
									</a></li>
									<li><a class="dropdown-item" th:href="@{/user/logout}">
											<i class="fas fa-sign-out-alt me-2"></i>Logout
									</a></li>
								</ul>
							</div>

						</div>

					</div>

				</div>
			</div>

			<!-- ================= CONTENT ================= -->

			<div class="main-content-wrapper" id="mainContent">

				<div class="card-header fuel-header text-center">
					<div class="d-flex justify-content-center align-items-center gap-2">
						<i class="fas fa-gas-pump"></i> <span
							class="fw-semibold fuel-title">Available Fuel Stations</span>
					</div>
				</div>

				<div class="row g-4">

					<div class="col-lg-4 col-md-6" th:each="s : ${stations}">
						<div class="card station-card h-100">

							<img
								th:src="${s.imageUrl != null && s.imageUrl != ''} ? @{${s.imageUrl}} : @{/images/default.jpg}"
								class="station-img w-100" th:alt="${s.name}" />

							<div class="card-body">
								<h5 class="fw-bold text-primary" th:text="${s.name}"></h5>

								<p class="text-muted small">
									<i class="fas fa-map-marker-alt fuel-location"></i> <span
										th:text="${s.area}"></span>, <span th:text="${s.city}"></span>
								</p>

								<p>
									Petrol: <span th:if="${s.petrolQty > 0}"> â‚¹<span
										th:text="${s.petrolRate}"></span>/L <span
										class="badge bg-success ms-2">Available</span>
									</span> <span th:unless="${s.petrolQty > 0}"> <span
										class="badge bg-danger ms-2">Not Available</span>
									</span>
								</p>
								<p>
									Diesel: <span th:if="${s.dieselQty > 0}"> â‚¹<span
										th:text="${s.dieselRate}"></span>/L <span
										class="badge bg-success ms-2">Available</span>
									</span> <span th:unless="${s.dieselQty > 0}"> <span
										class="badge bg-danger ms-2">Not Available</span>
									</span>
								</p>

								<div class="d-flex gap-2"
									th:if="${s.petrolQty > 0 or s.dieselQty > 0}">

									<a class="btn btn-primary w-50 btn-book"
										th:href="@{/user/book/{id}(id=${s.id})}"> Book Fuel </a> <a
										class="btn btn-outline-secondary w-50" target="_blank"
										th:href="@{'https://www.google.com/maps/search/?api=1&query=' 
                + ${s.area} + ',' + ${s.city}}">
										<i class="fas fa-location-arrow me-1"></i> Map
									</a>

								</div>

								<button class="btn btn-secondary w-100 mt-2"
									th:unless="${s.petrolQty > 0 or s.dieselQty > 0}" disabled>
									Fuel Not Available</button>
							</div>

						</div>
					</div>

				</div>

			</div>

		</div>
	</div>

	<!-- ================= JS ================= -->

	<script>

function loadBookings(status) {
    fetch('/user/bookings/' + status)
        .then(res => res.text())
        .then(html => {
            document.getElementById('mainContent').innerHTML = html;
        });
}

/* ================= THEME TOGGLE ================= */


function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("collapsed");
}


function toggleTheme() {
    document.body.classList.toggle("dark-mode");

    const icon = document.getElementById("themeIcon");

    if(document.body.classList.contains("dark-mode")) {
        icon.classList.remove("fa-moon");
        icon.classList.add("fa-sun");
        localStorage.setItem("theme","dark");
    } else {
        icon.classList.remove("fa-sun");
        icon.classList.add("fa-moon");
        localStorage.setItem("theme","light");
    }
}

window.onload = function() {
    if(localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
        document.getElementById("themeIcon").classList.replace("fa-moon","fa-sun");
    }
}

function setActive(el) {
    document.querySelectorAll('#sidebar .nav-link')
        .forEach(link => link.classList.remove('active'));
    el.classList.add('active');
}

</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>