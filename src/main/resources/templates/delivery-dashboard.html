<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Delivery Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- FontAwesome -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
	rel="stylesheet">

<style>
body {
	margin: 0;
	background: #eef1f6;
	overflow-x: hidden;
	font-family: "Segoe UI", sans-serif;
}

.wrapper {
	display: flex;
}

/* ================= Sidebar ================= */
#sidebar {
	width: 240px;
	min-height: 100vh;
	background: #0b1e33;
	transition: all 0.3s ease;
	padding: 20px;
}

#sidebar.collapsed {
	width: 80px;
}

#sidebar.collapsed .nav-text, #sidebar.collapsed .brand-text {
	display: none;
}

#sidebar.collapsed .nav-link {
	justify-content: center;
}

.brand {
	color: white;
	font-size: 20px;
	font-weight: bold;
	text-align: center;
	margin-bottom: 30px;
}

.nav-link {
	color: #cfd8dc;
	padding: 12px 15px;
	display: flex;
	align-items: center;
	gap: 12px;
	border-radius: 8px;
}

.nav-link:hover {
	background: #163a5f;
	color: white;
}

/* ================= Main Content ================= */
.main-content {
	flex-grow: 1;
}

/* ================= Topbar ================= */
.topbar {
	height: 70px;
	background: white;
	display: flex;
	align-items: center;
	padding: 0 30px;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
	position: relative;
	z-index: 1000;
}

.profile-dropdown {
	margin-left: auto;
	position: relative;
	cursor: pointer;
}

.profile-menu {
	position: absolute;
	right: 0;
	top: 120%;
	background: white;
	border-radius: 10px;
	box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
	display: none;
	min-width: 160px;
	z-index: 9999;
}

.profile-menu a {
	display: block;
	padding: 10px 15px;
	text-decoration: none;
	color: #333;
}

.profile-menu a:hover {
	background: #f1f1f1;
}

/* ================= Cards ================= */
.dashboard-area {
	padding: 30px;
}

.dashboard-card {
	height: 170px;
	border-radius: 18px;
	color: white;
	padding: 25px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
}

.dashboard-card h6 {
	font-size: 15px;
	opacity: 0.9;
}

.dashboard-card h2 {
	font-size: 38px;
	font-weight: bold;
}

.card-icon {
	font-size: 55px;
	opacity: 0.25;
}

.bg-assigned {
	background: linear-gradient(135deg, #4e73df, #224abe);
}

.bg-delivered {
	background: linear-gradient(135deg, #1cc88a, #13855c);
}

.bg-notdelivered {
	background: linear-gradient(135deg, #e74a3b, #be2617);
}

/* ================= Recent Activity ================= */
.activity-card {
	background: white;
	border-radius: 15px;
	padding: 25px;
	box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
}

.table th {
	color: #555;
	font-weight: 600;
}
</style>
</head>

<body>

	<div class="wrapper">

		<!-- Sidebar -->
		<div id="sidebar">
			<div class="brand">
				<span class="brand-text">FuelIndeed</span>
			</div>

			<ul class="nav flex-column">
				<li><a href="#" class="nav-link" onclick="toggleSidebar()">
						<i class="fas fa-bars"></i> <span class="nav-text">Menu</span>
				</a></li>

				<li><a th:href="@{/delivery/dashboard}" class="nav-link"><i
						class="fas fa-home"></i><span class="nav-text">Dashboard</span></a></li>
				<li><a th:href="@{/delivery/assigned}" class="nav-link"><i
						class="fas fa-check-circle"></i><span class="nav-text">Assigned
							Orders</span></a></li>
				<li><a th:href="@{/delivery/delivered}" class="nav-link"><i
						class="fas fa-truck"></i><span class="nav-text">Delivered</span></a></li>
				<li><a th:href="@{/delivery/not-delivered}" class="nav-link"><i
						class="fas fa-times-circle"></i><span class="nav-text">Not
							Delivered</span></a></li>
			</ul>
		</div>

		<!-- Main Content -->
		<div class="main-content">

			<!-- Topbar -->
			<div class="topbar">
				<div class="d-flex align-items-center gap-2">
					<i class="fas fa-truck-fast text-primary fs-5"></i> <span
						class="fw-semibold text-dark"> Delivery Agent Dashboard</span> </span>
				</div>

				<!-- ðŸ‘¤ PROFILE DROPDOWN RESTORED -->
				<div class="profile-dropdown" onclick="toggleProfile()">
					<i class="fas fa-user-circle fs-3 text-secondary"></i>

					<div class="profile-menu" id="profileMenu">
						<a th:href="@{/delivery/profile}"> <i class="fas fa-user me-2"></i>Profile
						</a> <a th:href="@{/delivery/logout}"> <i
							class="fas fa-sign-out-alt me-2"></i>Logout
						</a>
					</div>
				</div>
			</div>

			<!-- Cards -->
			<div class="dashboard-area">
				<div class="row g-4">
					<div class="col-md-4">
						<div class="dashboard-card bg-assigned">
							<div>
								<h6>Assigned Orders</h6>
								<h2 th:text="${assignedCount}">0</h2>
							</div>
							<i class="fas fa-clipboard-list card-icon"></i>
						</div>
					</div>

					<div class="col-md-4">
						<div class="dashboard-card bg-delivered">
							<div>
								<h6>Delivered Orders</h6>
								<h2 th:text="${deliveredCount}">0</h2>
							</div>
							<i class="fas fa-check-circle card-icon"></i>
						</div>
					</div>

					<div class="col-md-4">
						<div class="dashboard-card bg-notdelivered">
							<div>
								<h6>Not Delivered</h6>
								<h2 th:text="${notDeliveredCount}">0</h2>
							</div>
							<i class="fas fa-times-circle card-icon"></i>
						</div>
					</div>
				</div>

				<!-- Recent Activity -->
				<div class="row mt-5">
					<div class="col-12">
						<div class="activity-card">
							<h5 class="mb-4">Recent Activity</h5>

							<table class="table align-middle">
								<thead>
									<tr>
										<th>Order ID</th>
										<th>Customer</th>
										<th>Status</th>
										<th>Time</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="booking : ${recentBookings}">
										<td th:text="'#ORD' + ${booking.id}"></td>
										<td th:text="${booking.user.name}"></td>
										<td><span class="badge"
											th:classappend="${
                                                booking.status.name() == 'DELIVERED' ? 'bg-success' :
                                                (booking.status.name() == 'ASSIGNED' ? 'bg-warning text-dark' :
                                                'bg-danger')
                                              }"
											th:text="${booking.status}"> </span></td>
										<td
											th:text="${#temporals.format(booking.createdAt, 'dd MMM yyyy HH:mm')}"></td>
									</tr>

									<tr th:if="${#lists.isEmpty(recentBookings)}">
										<td colspan="4" class="text-center text-muted">No recent
											activity</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<script>
		function toggleSidebar() {
			document.getElementById("sidebar").classList.toggle("collapsed");
		}

		function toggleProfile() {
			const menu = document.getElementById("profileMenu");
			menu.style.display = menu.style.display === "block" ? "none"
					: "block";
		}

		window.onclick = function(e) {
			if (!e.target.closest(".profile-dropdown")) {
				document.getElementById("profileMenu").style.display = "none";
			}
		}
	</script>

</body>
</html>