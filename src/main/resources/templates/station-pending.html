<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Pending Bookings - Fuel Station</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body {
    background: #f4f6f9;
    font-family: 'Segoe UI', sans-serif;
}

/* ================= Sidebar ================= */
#sidebar {
    width: 240px;
    min-height: 100vh;
    background: linear-gradient(180deg,#0b1e33,#112e4a);
}

#sidebar .brand {
    font-size: 20px;
    font-weight: 600;
    letter-spacing: 1px;
}

#sidebar .nav-link {
    color: #cfd8dc;
    padding: 14px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-radius: 8px;
    margin-bottom: 6px;
    transition: 0.3s;
}

#sidebar .nav-link:hover,
#sidebar .active {
    background: #163a5f;
    color: white;
}

/* ================= Topbar ================= */
.topbar {
    height: 70px;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.page-title {
    font-weight: 600;
    color: #0b1e33;
}

/* ================= Profile ================= */
.profile-dropdown {
    position: relative;
    cursor: pointer;
}

.profile-dropdown-menu {
    position: absolute;
    right: 0;
    top: 120%;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    display: none;
    min-width: 170px;
    overflow: hidden;
    z-index: 100;
}

.profile-dropdown-menu a {
    display: block;
    padding: 12px 16px;
    color: #0b1e33;
    text-decoration: none;
    font-size: 0.95rem;
}

.profile-dropdown-menu a:hover {
    background: #f1f5f9;
}

/* ================= Table ================= */
.card {
    border-radius: 16px;
    border: none;
}

.table thead {
    background: #0b1e33;
    color: white;
}

.table th {
    font-size: 14px;
    text-transform: uppercase;
}

.table td {
    font-size: 14px;
    vertical-align: middle;
}

.table-hover tbody tr:hover {
    background-color: #f8fbff;
}

/* Keep action row always single line */
.action-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: nowrap;
}

.action-row select {
    width: 200px;
}

/* Buttons same height */
.action-row .btn {
    height: 32px;
    padding: 0 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
</head>

<body>
<div class="d-flex">

<!-- ================= SIDEBAR ================= -->
<div id="sidebar" class="p-3 text-white">
    <div class="text-center brand mb-4">FuelIndeed</div>

    <ul class="nav flex-column">
        <li><a th:href="@{/station/dashboard}" class="nav-link">
            <i class="fas fa-home"></i> Dashboard</a></li>

        <li><a th:href="@{/station/bookings/pending}" class="nav-link active">
            <i class="fas fa-clock"></i> Pending</a></li>

        <li><a th:href="@{/station/bookings/assigned}" class="nav-link">
            <i class="fas fa-user-check"></i> Assigned</a></li>

        <li><a th:href="@{/station/bookings/delivered}" class="nav-link">
            <i class="fas fa-check-circle"></i> Delivered</a></li>

        <li><a th:href="@{/station/bookings/rejected}" class="nav-link">
            <i class="fas fa-times-circle"></i> Rejected</a></li>
    </ul>
</div>

<!-- ================= MAIN ================= -->
<div class="flex-grow-1">

    <!-- Topbar -->
    <div class="topbar d-flex justify-content-between align-items-center px-4">
        <h5 class="page-title mb-0">Pending Bookings</h5>

        <div class="profile-dropdown" onclick="toggleProfileMenu()">
            <i class="fas fa-user-circle fs-3 text-secondary"></i>
            <div class="profile-dropdown-menu" id="profileMenu">
                <a th:href="@{/station/complete-profile}">
                    <i class="fas fa-user me-2"></i> My Profile
                </a>
                <a th:href="@{/station/logout}">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </a>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="container-fluid p-4">

        <div class="card shadow-sm p-4">

            <div class="table-responsive">
                <table class="table table-hover align-middle text-center">
                    
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>User</th>
                            <th>Fuel Type</th>
                            <th>Quantity (L)</th>
                            <th>Total Amount</th>
                            <th style="width: 360px;">Manage Booking</th>
                        </tr>
                    </thead>

                    <tbody>

                    <tr th:each="b : ${bookings}">
                        <td class="fw-semibold" th:text="${b.id}"></td>
                        <td th:text="${b.user.name}"></td>
                        <td th:text="${b.fuelType}"></td>
                        <td th:text="${b.quantity}"></td>
                        <td class="fw-semibold text-success">
                            â‚¹ <span th:text="${b.totalBill}"></span>
                        </td>

                        <td>
                            <!-- SINGLE FORM - SINGLE ROW -->
                            <form method="post"
                                  th:action="@{/station/bookings/approve}"
                                  class="action-row">

                                <input type="hidden" name="bookingId" th:value="${b.id}"/>

                                <select name="deliveryPersonId"
                                        class="form-select form-select-sm"
                                        required>
                                    <option value="" disabled selected>Assign Delivery Person</option>
                                    <option th:each="dp : ${deliveryPersons}"
                                            th:value="${dp.id}"
                                            th:text="${dp.name}">
                                    </option>
                                </select>

                                <button type="submit"
                                        class="btn btn-success btn-sm">
                                    <i class="fas fa-user-check me-1"></i>
                                    Confirm
                                </button>

                                <button type="submit"
                                        formaction="/station/bookings/reject"
                                        class="btn btn-danger btn-sm">
                                    <i class="fas fa-times me-1"></i>
                                    Decline
                                </button>

                            </form>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>
</div>

<!-- Profile Dropdown Script -->
<script>
function toggleProfileMenu() {
    const menu = document.getElementById("profileMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

window.onclick = function(e) {
    if (!e.target.closest('.profile-dropdown')) {
        document.getElementById("profileMenu").style.display = "none";
    }
}
</script>

</body>
</html>